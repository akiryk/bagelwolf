---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { marked } from 'marked';
import { Image } from 'astro:assets';
import bagelHero from '../assets/originals/bagel-page-hero.jpg';

const orderButtonEntries = await getCollection('order-button');
const orderButton = orderButtonEntries[0];
const { url: orderButtonUrl } = orderButton.data;

const bagelsPageEntries = await getCollection('bagels-page');
const bagelsPage = bagelsPageEntries[0];
const {
  introTitle,
  introBody,
  items,
  philosophyTitle,
  philosophyBody,
  ctaTitle,
  ctaBody,
} = bagelsPage.data;

// Parse markdown to HTML
const philosophyBodyHtml = await marked.parse(philosophyBody);
const ctaBodyHtml = await marked.parse(ctaBody);
---

<BaseLayout
  title="Bagels | Bagelwolf Bakery"
  description="Explore our sourdough bagel menu: Everything, Sesame, Plain, Poppy, Salt, and Pumpernickel. Hand-rolled, boiled, and baked fresh every Saturday in Durango, Colorado."
>
  <!-- Hero Section -->
  <section
    class="bagels-hero overflow-hidden bg-cover"
    style={`
      background-image: url(${bagelHero.src});
      background-position: center bottom;
    `}
  >
  </section>

  <style>
    .bagels-hero {
      /* Height increases as viewport widens: ~200px on mobile, ~400px on wide screens */
      height: clamp(200px, 25vw, 400px);
    }

    /* Hero paragraph with drop cap */
    .hero-paragraph {
      font-family: 'Spectral', serif;
      font-size: 20px;
      color: #000;
      line-height: 1.5;
    }

    @media (min-width: 1100px) {
      .hero-paragraph {
        font-size: 24px;
      }
    }

    .hero-paragraph::first-letter {
      float: left;
      font-size: 78px;
      line-height: 0.8;
      padding-right: 8px;
      padding-top: 4px;
      color: #db5009;
      font-weight: 300;
    }

    /* Bagel card wrapper with background that bleeds into gutter */
    .bagel-card-wrapper {
      position: relative;
    }

    .bagel-card-wrapper::before {
      content: '';
      position: absolute;
      top: 0;
      bottom: 0;
      /* Start at column 3 position minus half the gutter */
      left: calc(
        (2 * (100% + var(--grid-gutter)) / 9) - (var(--grid-gutter) / 2)
      );
      right: 0;
      background-color: #f4f2ea;
      z-index: 0;
    }

    .bagel-card h2 {
      font-family: 'Open Sans', sans-serif;
      font-weight: 300;
      font-size: 32px;
      color: #702600;
      margin-bottom: 8px;
    }

    .bagel-card p {
      font-family: 'Spectral', serif;
      font-size: 20px;
      color: #000;
      line-height: 1.5;
    }
  </style>

  <!-- Hero Paragraph Section -->
  <section class="grid-container py-16 md:py-10">
    <div class="grid-9">
      <div
        class="col-span-9 md:col-span-6 md:col-start-3 lg:col-span-5 lg:col-start-3"
      >
        <p class="hero-paragraph">
          {introBody}
        </p>
      </div>
    </div>
  </section>

  <!-- Bagel Cards -->
  <section class="grid-container">
    {
      items.map((item) => (
        <div class="bagel-card-wrapper grid-9 py-8 md:py-10 mb-5">
          {/* Image - 2 columns starting at col 3 (aligned with hero paragraph) */}
          <div class="col-span-9 md:col-span-2 md:col-start-3 mb-6 md:mb-0 relative z-10">
            {item.image ? (
              <img
                src={item.image}
                alt={item.name}
                class="aspect-square object-cover w-full"
              />
            ) : (
              <div class="aspect-square bg-stone-200 flex items-center justify-center">
                <span class="text-stone-400 text-sm">Photo coming soon</span>
              </div>
            )}
          </div>
          {/* Text content - starts at col 5 */}
          <div class="bagel-card col-span-9 md:col-span-4 md:col-start-5 flex flex-col justify-center px-4 md:px-0 relative z-10">
            <h2>{item.name}</h2>
            <p>{item.description}</p>
          </div>
        </div>
      ))
    }
  </section>

  <!-- Philosophy Section -->
  <section class="grid-container py-16 md:py-10">
    <div class="grid-9">
      <div
        class="col-span-9 md:col-span-6 md:col-start-3 lg:col-span-5 lg:col-start-3"
      >
        <h2 class="font-sans font-light text-[32px] text-stone-900 mb-8">
          {philosophyTitle}
        </h2>
        <div
          class="font-serif font-medium text-[20px] lg:text-[24px] text-stone-600 leading-relaxed space-y-6"
          set:html={philosophyBodyHtml}
        />
      </div>
    </div>
  </section>

  <!-- Order CTA -->
  <section class="bg-orange-50 py-16 md:py-20">
    <div class="max-w-3xl mx-auto px-4 text-center">
      <h2
        class="font-serif text-2xl md:text-3xl font-medium text-stone-900 mb-4"
      >
        {ctaTitle}
      </h2>
      <div class="text-stone-600 mb-6" set:html={ctaBodyHtml} />
      <a
        href={orderButtonUrl}
        target="_blank"
        rel="noopener noreferrer"
        class="inline-block px-8 py-4 bg-brand text-white text-lg font-semibold rounded hover:bg-brand-dark transition-colors focus:outline-none focus:ring-2 focus:ring-brand focus:ring-offset-2"
      >
        Order Online
      </a>
    </div>
  </section>
</BaseLayout>
