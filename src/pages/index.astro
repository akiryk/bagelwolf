---
import BaseLayout from '../layouts/BaseLayout.astro';

const featuredBagels = [
  { name: 'Plain', image: '/images/bagel-plain.png' },
  { name: 'Everything', image: '/images/bagel-everything.png' },
  { name: 'Onion', image: '/images/bagel-onion.png' },
  { name: 'Pumpernickel', image: '/images/bagel-pumpernickel.png' },
];
---

<BaseLayout
  title="Bagelwolf Bakery | Handrolled Sourdough Bagels in Durango"
  description="Fresh handrolled sourdough bagels and artisan breads baked in Durango, Colorado. Made with a homemade starter, traditional techniques, and 24-hour cold fermentation. Order online for Saturday pickup."
  image="/images/bagels-lg.png"
>
  <!-- Hero Section -->
  <!-- Desktop: side-by-side with parallax, 5/4 column split per 9-column grid -->
  <section class="hidden md:flex">
    <div class="hero-split-left h-[472px] overflow-hidden">
      <img
        src="/images/bagels-lg.png"
        alt="Freshly baked sourdough bagels"
        class="parallax-image w-full h-[750px] object-cover"
        data-speed="0.3"
      />
    </div>
    <div class="hero-split-right h-[520px] overflow-hidden">
      <img
        src="/images/boule-lg.png"
        alt="Artisan sourdough boule"
        class="parallax-image w-full h-[750px] object-cover"
        data-speed="0.5"
      />
    </div>
  </section>

  <!-- Mobile: single combined hero image -->
  <section class="md:hidden relative mb-6 md:mb-0">
    <img
      src="/images/hero-sm.png"
      alt="Freshly baked sourdough bagels and artisan bread"
      class="w-full h-auto object-cover"
    />
    <!-- ORDER NOW button centered -->
    <div class="absolute inset-0 flex items-center justify-center">
      <a
        href="https://www.hotplate.com/bagelwolf"
        target="_blank"
        rel="noopener noreferrer"
        class="px-8 py-3 bg-brand text-white text-lg font-medium tracking-wider rounded border border-white hover:bg-brand-dark transition-colors focus:outline-none focus:ring-2 focus:ring-brand focus:ring-offset-2"
      >
        ORDER NOW
      </a>
    </div>
  </section>

  <script>
    function initParallax() {
      // Only run parallax on desktop
      if (window.innerWidth < 768) return;

      const heroImages = document.querySelectorAll('.parallax-image');
      const upImages = document.querySelectorAll('.parallax-image-up');

      function updateParallax() {
        const scrollY = window.scrollY;

        // Hero images: move up as you scroll
        heroImages.forEach((img) => {
          const speed = parseFloat((img as HTMLElement).dataset.speed) || 0.3;
          const yOffset = scrollY * speed;
          (img as HTMLElement).style.transform = `translateY(-${yOffset}px)`;
        });

        // Upward parallax: starts low, moves up as you scroll
        upImages.forEach((img) => {
          const speed = parseFloat((img as HTMLElement).dataset.speed) || 0.4;
          const startOffset =
            parseFloat((img as HTMLElement).dataset.startOffset) || 100;
          const yOffset = startOffset - scrollY * speed;
          (img as HTMLElement).style.transform = `translateY(${yOffset}px)`;
        });
      }

      // Use requestAnimationFrame for smooth scrolling
      let ticking = false;
      function onScroll() {
        if (!ticking) {
          window.requestAnimationFrame(() => {
            updateParallax();
            ticking = false;
          });
          ticking = true;
        }
      }

      window.addEventListener('scroll', onScroll);

      // Initial call
      updateParallax();
    }

    // Run on initial page load
    initParallax();

    // Re-run after view transitions (for SPA-like navigation)
    document.addEventListener('astro:after-swap', initParallax);
  </script>

  <!-- Short Story Section -->
  <section class="grid-container mt-4 overflow-visible">
    <div class="grid-9">
      <!-- Puppy image in grid column (hidden below md breakpoint) -->
      <div
        class="hidden md:block col-span-2 col-start-2 lg:col-span-1 lg:col-start-3 overflow-visible"
      >
        <figure
          class="parallax-image-up"
          data-speed="0.25"
          data-start-offset="250"
        >
          <img
            src="/images/puppy-and-bagel.png"
            alt="Playful puppy with a bagel"
            class="w-full"
          />
          <figcaption class="font-sans font-light text-sm text-warm-brown mt-2">
            Jojo, the Bagelwolf puppy
          </figcaption>
        </figure>
      </div>
      <div
        class="col-span-9 col-start-1 md:col-span-6 md:col-start-4 lg:col-span-5 lg:col-start-4 xl:col-span-4 xl:col-start-4"
      >
        <h2 class="text-3xl md:text-4xl font-light text-stone-900 mb-8">
          The Bagelwolf Story
        </h2>
        <div
          class="font-serif font-medium text-stone-600 text-xl leading-relaxed space-y-6"
        >
          <!-- Floated puppy for mobile (below md breakpoint) -->
          <figure class="float-left mr-6 mb-4 w-[120px] md:hidden">
            <img
              src="/images/puppy-and-bagel.png"
              alt="Playful puppy with a bagel"
              class="w-full"
            />
            <figcaption
              class="font-sans font-light text-sm text-warm-brown mt-2"
            >
              Jojo, the Bagelwolf puppy
            </figcaption>
          </figure>
          <p>
            Bagelwolf is Adam Kiryk, a transplant from Brookline, Massachusetts
            who grew up on northeastern-style bagels. After a career in design
            and software development, Adam left to pursue his passion for baking
            sourdough breads.
          </p>
          <p>
            Every bagel is made with a homemade sourdough starter, hand-rolled
            using the traditional coil technique, and cold-fermented for 24
            hours to develop the perfect flavor and crust. The result? Chewy,
            flavorful bagels that taste like they should.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Signup Form -->
  <section class="grid-container py-10">
    <div class="grid-9">
      <div
        class="col-span-9 col-start-1 md:col-span-6 md:col-start-4 lg:col-span-5 lg:col-start-4 xl:col-span-4 xl:col-start-4"
      >
        <h2 class="text-3xl md:text-3xl font-light text-stone-900">
          Don't miss a drop!
        </h2>
        <div class="ml-embedded" data-form="37scIv"></div>
      </div>
    </div>
  </section>

  <!-- Featured Bagels Section -->
  <section class="py-8">
    <div class="grid-container">
      <div class="grid-9">
        <h2
          class="col-start-2 col-span-8 text-3xl md:text-3xl font-light text-stone-900 mb-10"
        >
          The Bagels
        </h2>
      </div>
      <div class="grid-9">
        {
          featuredBagels.map((bagel, index) => (
            <figure
              class:list={['col-span-2', index === 0 ? 'col-start-2' : '']}
            >
              <img
                src={bagel.image}
                alt={`${bagel.name} bagel`}
                class="w-full h-auto rounded"
              />
              <figcaption class="font-sans font-light text-sm text-warm-brown mt-2 text-center">
                {bagel.name}
              </figcaption>
            </figure>
          ))
        }
      </div>
      <div class="grid-9 mt-10">
        <div class="col-start-2 col-span-8">
          <a
            href="/bagels"
            class="text-brand font-medium hover:text-brand-light hover:underline transition-colors"
          >
            See all bagels &rarr;
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Learn More Section -->
  <section class="py-16 md:py-20">
    <div class="max-w-5xl mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <a
          href="/bagels"
          class="block p-8 bg-stone-100 rounded-lg hover:bg-stone-200 transition-colors group"
        >
          <h3
            class="font-serif text-2xl font-medium text-stone-900 mb-3 group-hover:text-brand"
          >
            Explore Our Bagels
          </h3>
          <p class="text-stone-600">
            From classic sesame to dark pumpernickel — discover our full lineup.
          </p>
        </a>
        <a
          href="/bread"
          class="block p-8 bg-stone-100 rounded-lg hover:bg-stone-200 transition-colors group"
        >
          <h3
            class="font-serif text-2xl font-medium text-stone-900 mb-3 group-hover:text-brand"
          >
            Artisan Breads
          </h3>
          <p class="text-stone-600">
            Country sourdough, olive rosemary, Danish rugbrød — and when to get
            them.
          </p>
        </a>
      </div>
    </div>
  </section>
</BaseLayout>
