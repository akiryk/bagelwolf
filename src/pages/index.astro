---
import BaseLayout from '../layouts/BaseLayout.astro';
import SignupForm from '../components/SignupForm.astro';
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import ParallaxScript from '../components/scripts/ParallaxScript.js';
import heroBoule from '../assets/originals/hero-boule-01.jpg';

const aboutEntries = await getCollection('about');
const about = aboutEntries[0];
const { title, image, imageAlt, imageCaption } = about.data;
const { Content } = await about.render();

const signupEntries = await getCollection('signup');
const signup = signupEntries[0];
const { heading: signupHeading } = signup.data;

const bagelsEntries = await getCollection('featured-bagels');
const bagelsSection = bagelsEntries[0];
const {
  title: bagelsTitle,
  items: featuredBagels,
  ctaText: bagelsCta,
  ctaLink: bagelsLink,
} = bagelsSection.data;

const breadsEntries = await getCollection('featured-breads');
const breadsSection = breadsEntries[0];
const {
  title: breadsTitle,
  items: featuredBreads,
  ctaText: breadsCta,
  ctaLink: breadsLink,
} = breadsSection.data;

const orderButtonEntries = await getCollection('order-button');
const orderButton = orderButtonEntries[0];
const { text: orderButtonText, url: orderButtonUrl } = orderButton.data;
---

<BaseLayout
  title="Bagelwolf Bakery | Handrolled Sourdough Bagels in Durango"
  description="Fresh handrolled sourdough bagels and artisan breads baked in Durango, Colorado. Made with a homemade starter, traditional techniques, and 24-hour cold fermentation. Order online for Saturday pickup."
  image="/images/bagels-lg.png"
>
  <!-- Hero Section -->
  <!-- Desktop: side-by-side with parallax, 5/4 column split per 9-column grid -->
  <section
    class="hidden md:flex w-full aspect-[1520/520] xl:aspect-[1520/400] 2xl:aspect-[1520/360]"
  >
    <div class="hero-split-left h-[472px] overflow-hidden">
      <img
        src="/images/bagels-lg.png"
        alt="Freshly baked sourdough bagels"
        class="parallax-image w-full h-[750px] lg:h-[850px] xl:h-[1000px] 2xl:h-[1100px] object-cover"
        data-speed="0.3"
      />
    </div>
    <div class="hero-split-right h-[520px] overflow-hidden">
      <Image
        src={heroBoule}
        alt="Artisan sourdough boule"
        class="parallax-image w-full h-[750px] lg:h-[850px] xl:h-[1000px] 2xl:h-[1100px] object-cover"
        data-speed="0.5"
        widths={[800, 1200, 1600, 2000]}
        sizes="(max-width: 768px) 100vw, 45vw"
      />
    </div>
  </section>

  <!-- Mobile: single combined hero image -->
  <section class="md:hidden relative mb-6 md:mb-0">
    <img
      src="/images/hero-sm.png"
      alt="Freshly baked sourdough bagels and artisan bread"
      class="w-full h-auto object-cover"
    />
    <!-- Mobile Only (see above section): ORDER NOW button centered -->
    <div class="absolute inset-0 flex items-center justify-center">
      <a
        href={orderButtonUrl}
        target="_blank"
        rel="noopener noreferrer"
        class="px-8 py-3 bg-brand text-white text-lg font-medium tracking-wider rounded border border-white hover:bg-brand-dark transition-colors focus:outline-none focus:ring-2 focus:ring-brand focus:ring-offset-2"
      >
        {orderButtonText}
      </a>
    </div>
  </section>

  <Fragment set:html={ParallaxScript} />

  <!-- About BagelWolf Section -->
  <section class="grid-container mt-4 overflow-visible">
    <div class="grid-9 grid-rows-[auto_1fr]">
      <!-- Heading in row 1 (desktop only) -->
      <h2
        class="hidden md:block row-start-1 md:col-span-6 md:col-start-4 lg:col-span-5 lg:col-start-4 xl:col-span-4 xl:col-start-4 text-3xl md:text-4xl font-light text-stone-900"
      >
        {title}
      </h2>

      <!-- Image in row 2 (hidden below md breakpoint) -->
      <div
        class="hidden md:block col-span-2 col-start-2 row-start-2 lg:col-span-1 lg:col-start-3 overflow-visible"
      >
        <figure>
          <img src={image} alt={imageAlt} class="w-full rounded" />
          <figcaption class="font-sans font-light text-sm text-warm-brown mt-2">
            {imageCaption}
          </figcaption>
        </figure>
      </div>

      <!-- Body content - full width on mobile (row 1), aligned with image on desktop (row 2) -->
      <div
        class="col-span-9 col-start-1 md:col-span-6 md:col-start-4 md:row-start-2 lg:col-span-5 lg:col-start-4 xl:col-span-4 xl:col-start-4"
      >
        <!-- Mobile heading -->
        <h2 class="md:hidden text-3xl font-light text-stone-900 mb-8">
          {title}
        </h2>
        <div
          class="font-serif font-medium text-stone-600 text-xl leading-relaxed space-y-6"
        >
          <!-- Floated image for mobile (below md breakpoint) -->
          <figure class="float-left mr-6 mb-4 w-[120px] md:hidden">
            <img src={image} alt={imageAlt} class="w-full" />
          </figure>
          <Content />
        </div>
      </div>
    </div>
  </section>

  <!-- Signup Form -->
  <section class="grid-container py-10">
    <div class="grid-9">
      <div
        class="col-span-9 col-start-1 md:col-span-6 md:col-start-4 lg:col-span-5 lg:col-start-4 xl:col-span-4 xl:col-start-4"
      >
        <h2 class="text-3xl md:text-3xl font-light text-stone-900">
          {signupHeading}
        </h2>
        <SignupForm />
      </div>
    </div>
  </section>

  <!-- Featured Bagels Section -->
  <section class="py-8">
    <div class="grid-container">
      <div class="grid-9">
        <h2
          class="col-start-1 md:col-start-2 col-span-8 text-3xl font-light text-stone-900 mb-5 md:mb-8"
        >
          {bagelsTitle}
        </h2>
      </div>
      <div class="grid-9">
        {
          featuredBagels.map((bagel, index) => (
            <figure
              class:list={[
                'col-span-3 md:col-span-2',
                index === 0 ? 'md:col-start-2' : '',
                index === 3 ? 'hidden md:block' : '',
              ]}
            >
              <img
                src={bagel.image}
                alt={`${bagel.name} bagel`}
                class="w-full h-auto rounded"
              />
              <figcaption class="font-sans font-light text-sm text-warm-brown mt-2 text-center">
                {bagel.name}
              </figcaption>
            </figure>
          ))
        }
      </div>
      <div class="grid-9 mt-4">
        <div class="col-start-1 md:col-start-2 col-span-8">
          <a
            href={bagelsLink}
            class="text-brand font-medium hover:text-brand-light hover:underline transition-colors"
          >
            {bagelsCta} &rarr;
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Breads Section -->
  <section class="py-8">
    <div class="grid-container">
      <div class="grid-9">
        <h2
          class="col-start-1 md:col-start-2 col-span-8 text-3xl font-light text-stone-900 mb-5 md:mb-8"
        >
          {breadsTitle}
        </h2>
      </div>
      <div class="grid-9">
        {
          featuredBreads.map((bread, index) => (
            <figure
              class:list={[
                'col-span-3 md:col-span-2',
                index === 0 ? 'md:col-start-2' : '',
                index === 3 ? 'hidden md:block' : '',
              ]}
            >
              <img
                src={bread.image}
                alt={`${bread.name} bread`}
                class="w-full h-auto rounded"
              />
              <figcaption class="font-sans font-light text-sm text-warm-brown mt-2 text-center">
                {bread.name}
              </figcaption>
            </figure>
          ))
        }
      </div>
      <div class="grid-9 mt-4">
        <div class="col-start-1 md:col-start-2 col-span-8">
          <a
            href={breadsLink}
            class="text-brand font-medium hover:text-brand-light hover:underline transition-colors"
          >
            {breadsCta} &rarr;
          </a>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
