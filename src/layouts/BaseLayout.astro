---
import { ViewTransitions } from 'astro:transitions';
import SEO from '../components/SEO.astro';
import '../styles/global.css';

interface Props {
  title?: string;
  description?: string;
  image?: string;
  type?: 'website' | 'article';
  noindex?: boolean;
}

const {
  title = 'Bagelwolf Bakery',
  description = 'Handrolled sourdough bagels and artisan breads baked fresh in Durango, Colorado. Made with a homemade starter, traditional techniques, and 24-hour cold fermentation.',
  image,
  type,
  noindex,
} = Astro.props;
const currentPath = Astro.url.pathname;

const navLinks = [
  { href: '/bagels', label: 'BAGELS' },
  { href: '/bread', label: 'BREADS' },
  { href: '/about', label: 'ABOUT' },
];

function isActive(href: string): boolean {
  if (href === '/') {
    return currentPath === '/';
  }
  return currentPath.startsWith(href);
}
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <SEO
      title={title}
      description={description}
      image={image}
      type={type}
      noindex={noindex}
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;700&family=Spectral:wght@200;300&display=swap"
      rel="stylesheet"
    />
    <ViewTransitions />
    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0ZT1PZ1PR7"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', 'G-0ZT1PZ1PR7');
    </script>
    <!-- Microsoft Clarity -->
    <script>
      (function (c, l, a, r, i, t, y) {
        c[a] =
          c[a] ||
          function () {
            (c[a].q = c[a].q || []).push(arguments);
          };
        t = l.createElement(r);
        t.async = 1;
        t.src = 'https://www.clarity.ms/tag/' + i;
        y = l.getElementsByTagName(r)[0];
        y.parentNode.insertBefore(t, y);
      })(window, document, 'clarity', 'script', 'ujyyq6cqdg');
    </script>
    <!-- MailerLite Universal -->
    <script>
      (function (w, d, e, u, f, l, n) {
        ((w[f] =
          w[f] ||
          function () {
            (w[f].q = w[f].q || []).push(arguments);
          }),
          (l = d.createElement(e)),
          (l.async = 1),
          (l.src = u),
          (n = d.getElementsByTagName(e)[0]),
          n.parentNode.insertBefore(l, n));
      })(
        window,
        document,
        'script',
        'https://assets.mailerlite.com/js/universal.js',
        'ml'
      );
      ml('account', '1976134');
    </script>
    <!-- End MailerLite Universal -->
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#db5009" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta name="msapplication-TileColor" content="#db5009" />
    <meta name="theme-color" content="#ffffff" />
  </head>
  <body class="min-h-screen flex flex-col bg-white text-stone-800 font-sans">
    <header class="bg-white relative">
      <!-- Mobile hamburger menu button - fixed in upper left -->
      <button
        id="mobile-menu-button"
        class="md:hidden absolute top-4 left-4 p-2 text-brand hover:text-brand-dark transition-colors z-10"
        aria-label="Open menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>

      <!-- Centered Logo -->
      <div class="text-center mb-6 mt-6 mx-6">
        <a href="/" class="inline-block">
          <video
            id="logo-video"
            autoplay
            muted
            playsinline
            preload="auto"
            class="block max-w-xs mx-auto mb-4"
          >
            <source src="/video/animation-3-step.webm" type="video/webm" />
            <source src="/video/animation-3-step.mp4" type="video/mp4" />
          </video>
        </a>
        <p class="font-serif text-warm-brown text-lg tracking-wide">
          Handrolled Sourdough Bagels & Artisanal Sourdough Breads
        </p>
        <!-- Location text - mobile only -->
        <p
          class="md:hidden font-serif text-warm-brown text-xs tracking-widest uppercase mt-4"
        >
          Made Fresh in Durango, Colorado
        </p>
      </div>

      <!-- Navigation Bar - desktop only -->
      <nav class="hidden md:block border-t border-b border-stone-200">
        <!-- Desktop nav with true center alignment -->
        <div
          class="grid grid-cols-3 items-center max-w-[1600px] mx-auto px-4 py-3"
        >
          <!-- Left: navigation links -->
          <ul class="flex gap-8 justify-self-start">
            {
              navLinks.map((link) => (
                <li>
                  <a
                    href={link.href}
                    class:list={[
                      'text-sm tracking-wider transition-colors',
                      isActive(link.href)
                        ? 'font-bold text-stone-900'
                        : 'text-stone-600 hover:text-stone-900',
                    ]}
                    aria-current={isActive(link.href) ? 'page' : undefined}
                  >
                    {link.label}
                  </a>
                </li>
              ))
            }
          </ul>

          <!-- Center: location text (truly centered) -->
          <p
            class="font-serif text-warm-brown text-xs tracking-widest uppercase justify-self-center"
          >
            Made Fresh in Durango, Colorado
          </p>

          <!-- Right: order button -->
          <a
            href="https://www.hotplate.com/bagelwolf"
            target="_blank"
            rel="noopener noreferrer"
            class="justify-self-end px-5 py-2 bg-brand text-white text-sm font-medium tracking-wider rounded hover:bg-brand-dark transition-colors focus:outline-none focus:ring-2 focus:ring-brand focus:ring-offset-2"
          >
            ORDER NOW
          </a>
        </div>
      </nav>

      <!-- Mobile menu overlay -->
      <div
        id="mobile-menu"
        class="fixed inset-0 bg-white z-50 hidden flex-col"
        aria-hidden="true"
      >
        <div class="flex justify-end p-4">
          <button
            id="mobile-menu-close"
            class="p-2 text-stone-600 hover:text-stone-900 transition-colors"
            aria-label="Close menu"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
        <nav class="flex-1 flex flex-col items-center justify-center gap-8">
          {
            navLinks.map((link) => (
              <a
                href={link.href}
                class:list={[
                  'text-2xl tracking-wider transition-colors',
                  isActive(link.href)
                    ? 'font-bold text-stone-900'
                    : 'text-stone-600 hover:text-stone-900',
                ]}
                aria-current={isActive(link.href) ? 'page' : undefined}
              >
                {link.label}
              </a>
            ))
          }
          <a
            href="https://www.hotplate.com/bagelwolf"
            target="_blank"
            rel="noopener noreferrer"
            class="mt-4 px-8 py-3 bg-brand text-white text-lg font-medium tracking-wider rounded hover:bg-brand-dark transition-colors"
          >
            ORDER NOW
          </a>
        </nav>
      </div>

      <!-- Mobile menu script -->
      <script>
        function initMobileMenu() {
          const menuButton = document.getElementById('mobile-menu-button');
          const menuClose = document.getElementById('mobile-menu-close');
          const mobileMenu = document.getElementById('mobile-menu');

          if (!menuButton || !menuClose || !mobileMenu) return;

          function openMenu() {
            mobileMenu.classList.remove('hidden');
            mobileMenu.classList.add('flex');
            mobileMenu.setAttribute('aria-hidden', 'false');
            menuButton.setAttribute('aria-expanded', 'true');
            document.body.style.overflow = 'hidden';
          }

          function closeMenu() {
            mobileMenu.classList.add('hidden');
            mobileMenu.classList.remove('flex');
            mobileMenu.setAttribute('aria-hidden', 'true');
            menuButton.setAttribute('aria-expanded', 'false');
            document.body.style.overflow = '';
          }

          menuButton.addEventListener('click', openMenu);
          menuClose.addEventListener('click', closeMenu);

          // Close menu when clicking a link
          mobileMenu.querySelectorAll('a').forEach((link) => {
            link.addEventListener('click', closeMenu);
          });

          // Close menu on escape key
          document.addEventListener('keydown', (e) => {
            if (
              e.key === 'Escape' &&
              !mobileMenu.classList.contains('hidden')
            ) {
              closeMenu();
            }
          });
        }

        initMobileMenu();
        document.addEventListener('astro:after-swap', initMobileMenu);
      </script>
    </header>

    <main id="main-content" class="flex-1">
      <slot />
    </main>

    <footer class="bg-stone-800 text-stone-200 py-12">
      <div class="max-w-5xl mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <!-- Brand & Location -->
          <div>
            <h2 class="font-serif text-xl text-white mb-2">BagelWolf</h2>
            <p class="text-stone-400">Durango, Colorado</p>
          </div>

          <!-- Contact -->
          <div>
            <h2 class="font-serif text-xl text-white mb-2">Contact</h2>
            <p class="text-stone-400">
              <a
                href="mailto:hello@bagelwolf.com"
                class="hover:text-white transition-colors"
              >
                hello@bagelwolf.com
              </a>
            </p>
            <p class="text-stone-400 mt-1">
              <a
                href="https://instagram.com/bagelwolf"
                target="_blank"
                rel="noopener noreferrer"
                class="hover:text-white transition-colors"
              >
                @bagelwolf
              </a>
            </p>
          </div>

          <!-- Newsletter Signup -->
          <div class="ml-embedded" data-form="37scIv"></div>
        </div>

        <div
          class="mt-8 pt-8 border-t border-stone-700 text-center text-stone-500 text-sm"
        >
          &copy; {new Date().getFullYear()} BagelWolf. All rights reserved.
        </div>
      </div>
    </footer>
  </body>
</html>
